# yaml-language-server: $schema=https://raw.githubusercontent.com/qgis-deployment/qgis-deployment-toolbelt-cli/refs/heads/main/docs/schemas/scenario/qdt_scenario.json

metadata:
  title: "Demonstration scenario of QGIS Deployment Toolbelt"
  id: qdt-ywt-scenario
  description: >-
    Demonstration scenario of QGIS Deployment Toolbelt capabilities.

# Toolbelt settings
settings:
  QGIS_EXE_PATH: "C:/OSGeo4W/bin/qgis-ltr-bin.exe"
  SCENARIO_VALIDATION: true

# Deployment workflow, step by step
steps:
  - name: Find installed QGIS
    uses: qgis-installation-finder
    with:
      if_not_found: warning

  - name: Download profiles from remote git repository
    uses: qprofiles-downloader
    with:
      source: https://github.com/yorkshire-wt/qgis-profiles.git
      protocol: git_remote
      branch: main

  - name: Synchronize installed profiles from downloaded ones
    uses: qprofiles-synchronizer
    with:
      sync_mode: overwrite

  - name: Synchronize plugins
    uses: qplugins-synchronizer
    with:
      action: remove

  - name: Set default profile to ywt_standard
    uses: default-profile-setter
    with:
      profile: "Standard"
      force_profile_selection_policy: 3

  - name: Set PGSERVICEFILE environment variables
    uses: manage-env-vars
    with:
      - name: PGSERVICEFILE
        action: "add"
        scope: "user"
        value: "M:\\M16_Databases\\16.1 Configs\\.pg_service.conf"
        value_type: path
      - name: QGIS_GLOBAL_SETTINGS_FILE
        action: "add"
        scope: "user"
        value: "C:\\OSGeo4W\\apps\\qgis-ltr\\resources\\qgis_global_settings.ini"
        value_type: path

  - name: Download plugins
    uses: qplugins-downloader
    with:
      force: false
      threads: 5

  - name: Synchronize plugins
    uses: qplugins-synchronizer
    with:
      action: create_or_restore
      profile_ref: downloaded
